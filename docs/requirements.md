# 艺术资源管理系统需求文档

## 1. 项目背景与目标

### 1.1 项目背景
游戏开发过程中，艺术资源管理是一个复杂且耗时的过程。开发团队需要：
- 管理大量的原始艺术资源（占位符）
- 对资源进行风格迁移以适应不同的游戏风格
- 将资源导入Unity游戏引擎
- 维护资源与游戏项目之间的映射关系
- 支持资源的快速替换和更新

### 1.2 项目目标
构建一个完整的艺术资源管理系统，实现：
- 集中化的艺术资源数据库管理
- 灵活的Tag分类和筛选系统
- 无缝的Unity集成和资源导入
- 可靠的路由表维护机制
- 高效的资源替换工作流

## 2. 功能需求

### 2.1 资源库管理

#### 2.1.1 资源入库
- 支持批量导入图片资源（PNG, JPG, PSD等格式）和音频资源（mp3,wav,ogg等）
- 自动生成唯一资源ID（UUID）
- 自动计算文件哈希值用于去重
- 支持资源元数据管理（名称、类型、大小等）
- 记录入库时间和更新时间

#### 2.1.2 Tag管理系统
- 支持为资源添加多个Tag
- Tag分类体系：
  - `org`：原始占位资源
  - `style_xxx`：风格标签（如`style_cartoon`, `style_realistic`）
  - `type_xxx`：资源类型（如`type_ui`, `type_character`, `type_scene`）
- 支持Tag的创建、删除、修改
- 添加Tag时有tags供选
- 支持批量添加/删除Tag
- 记录Tag变更历史

#### 2.1.3 资源查询与筛选
- 支持按名称搜索资源
- 支持按Tag组合筛选资源
- 支持按文件类型筛选
- 支持按时间范围筛选
- 提供高级查询功能（多条件组合）

### 2.2 Unity集成

#### 2.2.1 资源导入与Project创建
- 提供Unity编辑器窗口界面
- 支持从数据库浏览和选择资源
- 支持搜索栏筛选资源
- 支持勾选批量操作（重命名、导入）
- 支持单个资源导入（带编辑交互可改名）
- 指定Unity目标目录
- **导入org资源时自动创建Project**：
  - Project名称可自定义
  - Project用于管理该组资源及其风格化版本
  - Project中包含所有导入的org资源
  - Project提供风格化资源上传入口
  - 上传同名资源时自动关联为org的风格化版本
- 自动建立路由表关联

#### 2.2.2 Project管理
- **Project创建**：
  - Unity导入org资源时创建新Project
  - 支持手动创建空Project
  - Project包含元数据（名称、描述、创建时间）
- **Project资源管理**：
  - 显示Project中的所有org资源
  - 显示每个org资源关联的风格化资源
  - 支持在Project中浏览和筛选资源
- **风格化资源上传**：
  - 在Project中提供上传入口
  - 自动建立风格化资源与org的关联
  - 支持批量上传风格化资源
  - 上传时设置风格Tag（如style_cartoon）
- **Project操作**：
  - 支持Project的重命名
  - 支持Project的删除（需确认）
  - 支持导出Project资源清单

#### 2.2.3 路由表管理
- 记录数据库资源与Unity资源的映射关系
- 三层映射结构：
  - `DatabaseID` → `OriginalImportPath`
  - `DatabaseID` → `CurrentUnityPath`
  - `CurrentUnityPath` → `DatabaseID`
- 基于Unity的GUID建立唯一标识
- 支持路由表的可视化展示
- 记录路由表变更历史

#### 2.2.4 路径变更监听
- 监听Unity中资源的移动、重命名事件
- 自动更新路由表中的路径映射
- 支持手动触发路由表同步
- 提供冲突解决机制

### 2.3 风格迁移

#### 2.3.1 手动风格迁移
- **在Project中上传风格化资源**：
  - 支持手动上传风格化后的资源到Project
  - 通过资源名称匹配自动关联到对应的org资源
  - 上传时设置风格Tag（如style_cartoon, style_realistic）
  - 支持批量上传多个风格化资源
  - 支持预览上传的资源
- **风格化资源管理**：
  - 记录风格迁移参数和元数据
  - 记录上传时间和操作人
  - 支持删除风格化资源
  - 支持替换已上传的风格化资源

#### 2.3.2 风格迁移管理
- 记录风格迁移关系（原始资源 → 风格化资源）
- 支持一个原始资源对应多个风格化版本
- 支持风格化资源的再次风格迁移（链式关系）
- 提供资源关系树可视化
- 支持风格标签管理
- 支持按风格筛选资源

### 2.4 资源替换

#### 2.4.1 资源替换工作流
- 在数据库中选择原始资源（org）
- 查看关联的所有风格化资源
- 选择目标风格资源进行替换
- 自动更新路由表指向新资源
- Unity编辑器扩展自动替换Unity中的资源引用

#### 2.4.2 占位符管理
- 原始资源始终作为占位符存在
- 支持从占位资源切换到风格化资源
- 支持从风格化资源切换回占位资源
- 支持在不同风格化资源之间切换

#### 2.4.3 批量替换
- 支持按Tag批量选择资源
- 支持批量替换为指定风格
- 提供预览功能
- 支持回滚操作

## 3. 非功能需求

### 3.1 性能要求
- 资源查询响应时间 < 500ms（1000条记录以内）
- 批量导入100张图片 < 30秒
- 路由表更新实时性 < 1秒
- 支持至少10,000个资源的管理

### 3.2 可扩展性
- 支持自定义Tag分类体系
- 支持扩展新的资源类型
- 支持多数据库后端（SQLite/PostgreSQL）

### 3.3 易用性
- 直观的用户界面
- 清晰的操作流程
- 完善的错误提示
- 详细的操作日志
- 支持快捷键操作

### 3.4 可靠性
- 数据库事务支持，保证数据一致性
- 路由表变更历史记录，支持回滚
- 异常处理和错误恢复
- 数据备份和恢复机制


## 4. 用户故事

### 4.1 资源入库
> 作为美术人员，我想要批量导入原始资源到数据库，并为它们设置合适的Tag，以便后续管理和筛选。

### 4.2 资源导入Unity与Project创建
> 作为游戏开发者，我想要从数据库中选择需要的资源导入到Unity项目中，并在导入时重命名资源，同时创建一个Project来管理这些资源，以便符合项目命名规范并集中管理资源。

### 4.3 风格化资源上传
> 作为美术人员，我想要在Project中上传风格化后的资源，系统自动通过名称匹配关联到对应的org资源，以便快速建立风格化版本。

### 4.4 资源替换
> 作为游戏开发者，我想要将Unity中的占位符资源替换为风格化后的资源，并且能够随时切换回占位符或切换到其他风格。

### 4.5 路由表维护
> 作为系统管理员，我想要自动维护资源与Unity项目之间的映射关系，即使资源在Unity中被移动或重命名，也能保持关联。

### 4.6 资源查询
> 作为美术人员，我想要通过Tag和关键词快速找到需要的资源，以便提高工作效率。

## 5. 验收标准

### 5.1 资源库管理
- [ ] 能够成功导入至少1000张图片资源
- [ ] 能够为资源添加、删除、修改Tag
- [ ] 能够通过Tag组合筛选资源
- [ ] 能够通过关键词搜索资源
- [ ] 资源去重功能正常工作

### 5.2 Unity集成
- [ ] 能够从Unity编辑器窗口浏览数据库资源
- [ ] 能够批量选择并导入资源到Unity
- [ ] 能够在导入时重命名资源
- [ ] 能够自动创建Project
- [ ] 能够在Project中上传风格化资源
- [ ] 能够通过名称匹配自动关联org和风格化资源
- [ ] 能够自动建立路由表关联
- [ ] 能够自动监听并更新Unity资源路径变更

### 5.3 风格迁移
- [ ] 能够手动上传风格化资源
- [ ] 能够建立原始资源与风格化资源的关联
- [ ] 能够可视化展示资源关系树
- [ ] 能够批量进行风格迁移

### 5.4 资源替换
- [ ] 能够将Unity中的资源替换为风格化资源
- [ ] 能够在不同风格资源之间切换
- [ ] 能够批量替换资源
- [ ] 能够回滚替换操作

### 5.5 路由表维护
- [ ] 路由表能够正确记录资源映射关系
- [ ] 路径变更能够自动同步到路由表
- [ ] 路由表变更历史能够追溯
- [ ] 路由表可视化展示正常工作

### 5.6 性能测试
- [ ] 1000条记录查询响应时间 < 500ms
- [ ] 批量导入100张图片 < 30秒
- [ ] 路由表更新实时性 < 1秒

## 6. 约束与假设

### 6.1 技术约束
- 使用Unity 2021.3或更高版本
- 数据库使用SQLite（开发阶段）或PostgreSQL（生产环境）

### 6.2 业务约束
- 原始资源（org）不能被删除
- 路由表变更需要记录历史
- 资源替换需要可回滚

### 6.3 假设
- 用户具备基本的Unity编辑器使用经验
- 资源文件命名遵循一定的规范
- 风格化资源与org资源名称保持一致（便于自动关联）

## 7. 风险与依赖

### 7.1 技术风险
- Unity资源路径监听可能存在性能问题
- 大规模资源管理可能影响数据库性能
- 资源名称匹配可能存在歧义

### 7.2 外部依赖
- Unity Editor API

### 7.3 缓解措施
- 优化数据库查询和索引
- 实现资源分页加载
- 提供手动关联功能作为名称匹配的备选方案
- 实现资源名称规范化工具
