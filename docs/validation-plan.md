# 艺术资源管理系统 - 快速验证计划

## 1. 设计文档分析总结

### 1.1 设计合理的方面 ✅

1. **架构清晰** - 三层架构（WPF应用、Unity扩展、共享业务逻辑）分离良好
2. **数据库设计完整** - 10张表覆盖所有核心实体和关系
3. **API接口完善** - 涵盖资源、Tag、Project、风格迁移等所有功能
4. **核心算法设计合理** - 名称匹配算法（Levenshtein距离）、资源去重（SHA256哈希）
5. **数据流设计清晰** - 5个核心流程都有详细的流程图
6. **技术栈选择合理** - .NET 6.0 + WPF + Unity 2021.3 LTS + SQLite/PostgreSQL

### 1.2 需要澄清的问题 ⚠️

#### 问题1：AssetGroups 功能超出需求范围
- **现象**：requirements.md 中没有明确提到序列帧动画管理需求
- **设计**：design.md 中大量设计了 AssetGroups 表、GroupAssets 表和相关API
- **影响**：增加了系统复杂度，可能延长开发周期
- **建议**：将 AssetGroups 功能作为二期需求，一期专注核心功能

#### 问题2：Project 创建时机不明确
- **需求**：requirements.md 说"导入org资源时自动创建Project"
- **设计**：design.md 也支持"手动创建空Project"
- **影响**：两种方式的优先级和使用场景不明确
- **建议**：明确只支持"导入时自动创建"，简化用户操作流程

#### 问题3：风格化资源上传入口位置
- **需求**：requirements.md 强调"在Project中提供上传入口"
- **设计**：架构图显示 WPF 有独立的 "Style Upload Window"
- **影响**：可能造成用户操作混淆
- **建议**：统一在 Project Manager Window 中提供上传功能

#### 问题4：WPF与Unity的通信机制未明确
- **现象**：设计文档未说明 WPF 应用和 Unity 扩展如何通信
- **影响**：可能导致实现时架构不清晰
- **建议**：明确通信方式（共享数据库、REST API、文件系统等）

### 1.3 设计与需求对齐检查

| 需求项 | requirements.md | design.md | 对齐状态 |
|--------|----------------|-----------|----------|
| 资源入库 | ✓ 批量导入、去重、UUID | ✓ 完整设计 | ✅ 对齐 |
| Tag管理 | ✓ 多Tag、分类体系 | ✓ 完整设计 | ✅ 对齐 |
| 资源查询 | ✓ 多条件筛选 | ✓ 完整API | ✅ 对齐 |
| Unity导入 | ✓ 浏览、选择、导入 | ✓ 完整设计 | ✅ 对齐 |
| Project管理 | ✓ 创建、管理、上传 | ✓ 完整设计 | ⚠️ 创建时机需明确 |
| 风格化上传 | ✓ 名称匹配、关联 | ✓ 完整算法 | ✅ 对齐 |
| 资源替换 | ✓ 替换、切换、回滚 | ✓ 完整设计 | ✅ 对齐 |
| 路由表维护 | ✓ 自动同步、历史 | ✓ 完整设计 | ✅ 对齐 |
| 序列帧动画 | ✗ 未提及 | ✓ 完整设计 | ⚠️ 超出需求 |

## 2. 快速验证计划（3阶段）

### 2.1 阶段1：核心数据流验证（2-3天）

**目标**：验证最小可行路径，确保核心数据模型正确

#### 任务1.1：数据库Schema验证
- **实现内容**：
  - 创建 SQLite 数据库
  - 创建核心表：ArtAssets、Tags、AssetTags、Projects、ProjectAssets
  - 创建索引
- **测试用例**：
  - 插入10条资源记录
  - 插入5个Tag
  - 建立资源与Tag的关联
  - 查询性能测试（< 500ms）
- **验收标准**：
  - 所有表创建成功
  - 外键约束正常工作
  - 查询性能满足要求

#### 任务1.2：资源入库流程验证
- **实现内容**：
  - 文件哈希计算（SHA256）
  - 资源去重逻辑
  - 资源元数据提取（图片宽高、音频时长）
  - UUID生成
- **测试用例**：
  - 导入10张不同的图片
  - 导入2张相同的图片（验证去重）
  - 导入5个音频文件
  - 批量导入100张图片（性能测试）
- **验收标准**：
  - 相同文件只入库一次
  - 元数据正确提取
  - 100张图片导入 < 30秒

#### 任务1.3：Tag系统验证
- **实现内容**：
  - Tag CRUD操作
  - 资源Tag关联
  - 按Tag筛选资源
- **测试用例**：
  - 创建 org、style_cartoon、type_ui 等Tag
  - 为资源添加多个Tag
  - 按Tag组合查询资源
  - 批量添加/删除Tag
- **验收标准**：
  - Tag能正确创建和关联
  - 多Tag组合查询正确
  - 批量操作正常

#### 任务1.4：Project管理验证
- **实现内容**：
  - Project创建
  - 资源与Project关联
  - Project资源查询
- **测试用例**：
  - 创建3个Project
  - 为每个Project关联5个资源
  - 查询Project中的所有资源
  - 查询资源所属的Project
- **验收标准**：
  - Project能正确创建
  - 资源关联正确
  - 查询结果准确

**阶段1总结**：
- 预计时间：2-3天
- 关键产出：核心数据模型验证通过
- 风险点：数据库性能、去重算法准确性

---

### 2.2 阶段2：Unity集成验证（3-4天）

**目标**：验证Unity导入和路由表维护机制

#### 任务2.1：Unity编辑器窗口创建
- **实现内容**：
  - 创建简单的资源浏览窗口
  - 显示数据库中的资源列表
  - 支持搜索和筛选
  - 支持资源选择
- **测试用例**：
  - 在Unity中打开资源浏览窗口
  - 浏览数据库中的资源
  - 搜索特定资源
  - 按Tag筛选资源
- **验收标准**：
  - 窗口能正常显示
  - 资源列表正确加载
  - 搜索和筛选功能正常

#### 任务2.2：资源导入Unity验证
- **实现内容**：
  - 从数据库复制文件到Unity项目
  - 获取Unity资源GUID
  - 创建路由表记录
  - 关联到Project
- **测试用例**：
  - 导入单个资源到Unity
  - 批量导入10个资源
  - 导入时重命名资源
  - 导入已存在的资源（验证去重）
- **验收标准**：
  - 资源能正确导入到Unity
  - GUID能正确获取
  - 路由表记录正确
  - 去重逻辑正常工作

#### 任务2.3：路由表维护验证
- **实现内容**：
  - 实现 UnityRoutes 表
  - 实现 RouteHistory 表
  - 监听Unity资源路径变更
  - 自动更新路由表
- **测试用例**：
  - 在Unity中移动资源
  - 在Unity中重命名资源
  - 查询路由表变更历史
  - 手动触发路由表同步
- **验收标准**：
  - 路径变更能自动同步
  - 路由表更新 < 1秒
  - 历史记录正确

#### 任务2.4：风格化资源上传验证
- **实现内容**：
  - 实现 StyleMigrations 表
  - 实现名称匹配算法
  - 创建风格迁移关联
- **测试用例**：
  - 上传与org资源同名的风格化资源
  - 上传名称相似的风格化资源（验证模糊匹配）
  - 上传无法匹配的风格化资源
  - 批量上传10个风格化资源
- **验收标准**：
  - 精确匹配成功率 100%
  - 模糊匹配成功率 > 80%
  - 无法匹配时有明确提示
  - 批量上传正常

**阶段2总结**：
- 预计时间：3-4天
- 关键产出：Unity集成验证通过
- 风险点：Unity API兼容性、路径监听性能、名称匹配准确性

---

### 2.3 阶段3：资源替换验证（2-3天）

**目标**：验证完整的资源替换工作流

#### 任务3.1：资源替换功能验证
- **实现内容**：
  - 查询资源的风格化版本
  - 更新路由表指向
  - 替换Unity中的资源引用
  - 记录替换历史
- **测试用例**：
  - 将org资源替换为风格化资源
  - 将风格化资源切换回org资源
  - 在不同风格化资源之间切换
  - 查询替换历史
- **验收标准**：
  - 替换成功率 100%
  - Unity中的引用正确更新
  - 历史记录完整

#### 任务3.2：批量替换验证
- **实现内容**：
  - 按Tag批量选择资源
  - 批量替换为指定风格
  - 提供预览功能
  - 支持回滚操作
- **测试用例**：
  - 批量替换10个资源
  - 预览替换结果
  - 执行批量替换
  - 回滚批量替换
- **验收标准**：
  - 批量替换成功
  - 预览功能正确
  - 回滚功能正常

#### 任务3.3：WPF界面验证（可选）
- **实现内容**：
  - 创建资源浏览窗口
  - 创建Project管理窗口
  - 创建风格化上传窗口
- **测试用例**：
  - 通过UI浏览资源
  - 通过UI筛选资源
  - 通过UI管理Project
  - 通过UI上传风格化资源
- **验收标准**：
  - UI响应流畅
  - 操作逻辑清晰
  - 错误提示友好

#### 任务3.4：性能和压力测试
- **实现内容**：
  - 导入1000张图片
  - 查询1000条记录
  - 批量替换100个资源
- **测试用例**：
  - 1000条记录查询响应时间
  - 100张图片导入时间
  - 路由表更新实时性
  - 并发操作测试
- **验收标准**：
  - 1000条记录查询 < 500ms
  - 100张图片导入 < 30秒
  - 路由表更新 < 1秒
  - 并发操作无数据冲突

**阶段3总结**：
- 预计时间：2-3天
- 关键产出：完整工作流验证通过
- 风险点：批量操作性能、Unity资源引用更新

---

## 3. 验证时间表

```
Day 1-2:  阶段1.1-1.2 - 数据库Schema + 资源入库
Day 3:    阶段1.3-1.4 - Tag系统 + Project管理
Day 4-5:  阶段2.1-2.2 - Unity窗口 + 资源导入
Day 6-7:  阶段2.3-2.4 - 路由表 + 风格化上传
Day 8-9:  阶段3.1-3.2 - 资源替换 + 批量操作
Day 10:   阶段3.3     - WPF界面（可选）
Day 11-12: 阶段3.4    - 性能测试 + 问题修复
```

**总计**：7-12天（取决于是否实现WPF界面）

---

## 4. 关键验证点

### 4.1 功能验证点

| 验证项 | 验证方法 | 通过标准 |
|--------|----------|----------|
| 资源去重 | 导入相同文件 | 只入库一次 |
| 名称匹配 | 上传同名/相似名资源 | 精确匹配100%，模糊匹配>80% |
| 路由表同步 | 移动Unity资源 | 自动更新<1秒 |
| 资源替换 | 替换并检查引用 | 引用正确更新 |
| 批量操作 | 批量导入/替换 | 无错误，性能达标 |

### 4.2 性能验证点

| 性能指标 | 需求 | 测试方法 | 通过标准 |
|----------|------|----------|----------|
| 查询响应时间 | < 500ms | 查询1000条记录 | < 500ms |
| 批量导入时间 | < 30秒 | 导入100张图片 | < 30秒 |
| 路由表更新 | < 1秒 | 移动资源并计时 | < 1秒 |
| 并发操作 | 无冲突 | 多用户同时操作 | 数据一致 |

### 4.3 数据一致性验证点

| 验证项 | 验证方法 | 通过标准 |
|--------|----------|----------|
| 文件哈希准确性 | 对比手动计算结果 | 100%一致 |
| 路由表映射正确性 | 交叉验证GUID和路径 | 100%正确 |
| 风格化资源关联 | 验证关联关系 | 100%正确 |
| 事务一致性 | 模拟异常中断 | 数据不损坏 |

### 4.4 边界情况验证点

| 边界情况 | 测试方法 | 预期行为 |
|----------|----------|----------|
| 同名文件 | 导入同名不同内容文件 | 通过哈希区分 |
| 名称匹配失败 | 上传无法匹配的资源 | 提示用户手动关联 |
| Unity资源被删除 | 删除Unity资源 | 路由表标记为inactive |
| 空Project | 创建空Project | 允许创建，提示无资源 |
| 超大文件 | 导入>100MB文件 | 拒绝或警告 |
| 特殊字符 | 文件名包含特殊字符 | 正确处理或规范化 |

---

## 5. 风险评估与缓解措施

### 5.1 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| Unity API兼容性问题 | 高 | 中 | 提前测试目标Unity版本 |
| 路径监听性能问题 | 中 | 中 | 实现节流机制，批量更新 |
| 名称匹配准确性不足 | 中 | 低 | 提供手动关联功能 |
| 数据库性能瓶颈 | 高 | 低 | 优化索引，实现分页 |
| 大文件处理慢 | 中 | 中 | 异步处理，显示进度 |

### 5.2 需求风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| Project创建时机不明确 | 中 | 高 | 与需求方确认，统一策略 |
| AssetGroups功能超出范围 | 低 | 高 | 作为二期需求，一期不实现 |
| WPF与Unity通信机制未定 | 高 | 中 | 明确通信方式（建议共享数据库） |
| 风格化上传入口不统一 | 低 | 中 | 统一在Project管理界面 |

### 5.3 进度风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| 开发时间超出预期 | 高 | 中 | 优先实现核心功能，WPF界面可选 |
| 测试用例不充分 | 中 | 低 | 提前准备测试数据和脚本 |
| 问题修复时间长 | 中 | 中 | 预留2天缓冲时间 |

---

## 6. 建议与改进

### 6.1 设计改进建议

1. **简化 Project 创建流程**
   - 建议：只支持"导入时自动创建Project"
   - 理由：简化用户操作，减少混淆
   - 影响：需要修改 design.md 中的 Project 创建API

2. **暂缓 AssetGroups 功能**
   - 建议：将序列帧动画管理作为二期需求
   - 理由：一期专注核心功能，降低复杂度
   - 影响：可以删除 AssetGroups、GroupAssets 相关设计

3. **统一风格化上传入口**
   - 建议：只在 Project Manager Window 中提供上传功能
   - 理由：符合需求，避免用户混淆
   - 影响：需要修改架构图，删除独立的 Style Upload Window

4. **明确 WPF 与 Unity 通信机制**
   - 建议：使用共享 SQLite 数据库作为通信方式
   - 理由：简单可靠，无需额外的网络通信
   - 影响：需要在 design.md 中补充通信机制说明

### 6.2 实现优先级建议

**P0（必须实现）**：
- 资源入库（去重、UUID、哈希）
- Tag系统（创建、关联、查询）
- Project管理（创建、关联）
- Unity导入（浏览、导入、GUID）
- 路由表（创建、更新、历史）
- 风格化上传（名称匹配、关联）
- 资源替换（替换、历史）

**P1（重要但可延后）**：
- WPF资源浏览界面
- 批量操作优化
- 高级查询功能
- 路径监听优化

**P2（二期需求）**：
- AssetGroups（序列帧动画）
- 资源关系树可视化
- 数据备份和恢复
- PostgreSQL支持

### 6.3 测试数据准备建议

1. **准备测试资源**：
   - 10张不同的PNG图片（各种尺寸）
   - 2张相同的图片（验证去重）
   - 5个音频文件（MP3、WAV）
   - 100张图片（性能测试）
   - 10个同名不同风格的资源（验证名称匹配）

2. **准备测试脚本**：
   - 批量导入脚本
   - 性能测试脚本
   - 数据清理脚本

3. **准备Unity测试项目**：
   - 创建空的Unity项目
   - 配置测试场景
   - 准备测试资源引用

---

## 7. 验收标准总结

### 7.1 阶段1验收标准
- [ ] 数据库Schema创建成功
- [ ] 资源能成功入库并去重
- [ ] Tag系统正常工作
- [ ] Project能正确创建和关联资源
- [ ] 查询性能满足要求（< 500ms）

### 7.2 阶段2验收标准
- [ ] Unity编辑器窗口能正常显示
- [ ] 资源能从数据库导入到Unity
- [ ] 路由表能正确记录和更新
- [ ] 风格化资源能通过名称自动匹配
- [ ] 路由表更新实时性满足要求（< 1秒）

### 7.3 阶段3验收标准
- [ ] 资源替换功能正常工作
- [ ] 批量操作性能满足要求（< 30秒）
- [ ] 替换历史能正确记录
- [ ] WPF界面（可选）能正常使用
- [ ] 所有性能指标达标

### 7.4 整体验收标准
- [ ] 所有核心功能验证通过
- [ ] 所有性能指标达标
- [ ] 所有边界情况处理正确
- [ ] 数据一致性验证通过
- [ ] 无阻塞性Bug

---

## 8. 下一步行动

1. **与需求方确认**：
   - Project创建时机（自动 vs 手动）
   - AssetGroups功能是否必须（建议二期）
   - 风格化上传入口位置（建议统一）
   - WPF与Unity通信机制（建议共享数据库）

2. **更新设计文档**：
   - 根据确认结果更新 design.md
   - 补充通信机制说明
   - 调整功能优先级

3. **准备开发环境**：
   - 安装 Visual Studio 2022
   - 安装 Unity 2021.3 LTS
   - 准备测试数据和脚本

4. **开始阶段1验证**：
   - 创建数据库Schema
   - 实现资源入库流程
   - 实现Tag系统
   - 实现Project管理

---

## 附录：快速参考

### 核心表结构
- ArtAssets（资源表）
- Tags（标签表）
- AssetTags（资源标签关联表）
- Projects（项目表）
- ProjectAssets（项目资源关联表）
- StyleMigrations（风格迁移表）
- UnityRoutes（Unity路由表）
- RouteHistory（路由历史表）

### 核心API
- IAssetService（资源管理）
- ITagService（Tag管理）
- IProjectService（Project管理）
- IStyleService（风格迁移）
- IRouteService（路由表）

### 核心算法
- 文件哈希计算（SHA256）
- 资源名称匹配（Levenshtein距离）
- 资源去重（基于哈希）
- 路由表同步（基于Unity事件）
